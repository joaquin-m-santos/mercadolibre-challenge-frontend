<template>
  <form>
    <input
      v-model="query"
      type="text"
      placeholder="Buscar productos, marcas y mÃ¡s..."
    />
    <button class="nav__button" @click.prevent="pushRoute">
      <i class="icon-search"></i>
    </button>
  </form>
</template>

<script>
import { mapActions } from 'vuex'

export default {
  name: 'SearchBar',
  data() {
    return {
      query: this.searchQuery,
    }
  },

  watch: {
    '$route.query.search'() {
      this.setDataByQueryString()
    },
  },

  mounted() {
    this.setDataByQueryString()
  },

  methods: {
    ...mapActions(['fetchProducts', 'pushRoute']),
    pushRoute() {
      this.$router.push({
        path: '/items',
        query: { search: encodeURI(this.query) },
      })
    },
    setDataByQueryString() {
      if (typeof this.$route.query.search === 'string') {
        if (this.query !== this.$route.query.search)
          this.query = decodeURI(this.$route.query.search)
      }
    },
  },
}
</script>
